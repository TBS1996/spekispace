import e from"https://esm.sh/cytoscape@3.23.0";import t from"https://esm.sh/cytoscape-dagre@2.4.0";import{onNodeClick as o,onEdgeClick as n}from"/wasm/speki-web.js";e.use(t);let a=new Map;export function createCytoInstance(t){a.has(t)&&(console.log(`Cytoscape instance with ID "${t}" already exists. Destroying it...`),a.get(t).destroy(),a.delete(t));let r=document.getElementById(t);console.log(`Creating new Cytoscape instance for container id ${t}, w container: ${r}`);let l=e({container:r,elements:[],minZoom:.5,maxZoom:4,style:[{selector:"node",style:{"background-color":"data(backgroundColor)","border-color":"#000","border-width":1,shape:"data(shape)",label:"data(label)",color:"#000","text-wrap":"wrap","text-valign":"center","text-halign":"center",width:e=>Math.min(400,20*e.data("label").length),height:e=>20*Math.ceil(e.data("label").length/20)+10,"font-size":"6px"}},{selector:"edge",style:{"line-color":"#000",width:1,"target-arrow-color":"#ccc","target-arrow-shape":"triangle","arrow-scale":.5,"target-distance-from-node":3,"curve-style":"bezier"}}]});return console.log("adding on tap"),l.on("tap","node",e=>{let n=e.target.id();console.log(`Node clicked: ${n}`),o(t,n)}),l.on("tap","edge",e=>{let o=e.target,a=o.id(),r=o.source().id(),l=o.target().id();console.log(`Edge clicked: ${a}`),console.log(`Source Node: ${r}`),console.log(`Target Node: ${l}`),console.log("bruhhhuhu"),n(t,r,l)}),console.log("setting instance"),a.set(t,l),l}export function setContainer(e){let t=getCytoInstance(e),o=document.getElementById(e);o?(console.log(`Setting container for Cytoscape instance with ID "${e}"`),t.mount(o)):console.error(`Container with ID "${e}" not found.`)}export function zoomToNode(e,t){let o=getCytoInstance(e),n=o.getElementById(t);o.center(n),o.zoom({level:3,position:{x:n.position("x"),y:n.position("y")}})}export function getCytoInstance(e){return a.get(e)}export function runLayout(e,t){let o=getCytoInstance(e);o?(o.layout({name:"dagre",rankDir:"BT",fit:!0,padding:50,nodeSep:50,rankSep:25,edgeWeight:e=>e.source().id()===t||e.target().id()===t?3:1}).run(),function(e,t){let o=e.getElementById(t),n=o.position(),a=o.incomers("node"),r=o.outgoers("node");r.forEach((e,t)=>{e.position({x:n.x+50*t-50*r.length/2,y:n.y-60})}),a.forEach((e,t)=>{e.position({x:n.x+50*t-50*a.length/2,y:n.y+60})}),e.fit()}(o,t),o.reset(),o.fit()):console.warn(`Cytoscape instance with ID "${e}" not found.`)}export function addEdge(e,t,o){let n=getCytoInstance(e);n&&n.add({data:{source:t,target:o}})}export function addNode(e,t,o,n,a){let r=getCytoInstance(e);if(r){let e=function(e){let t=e.split(" "),o=[],n="";return t.forEach(e=>{(n+e).length>20?(o.push(n.trim()),n=e+" "):n+=e+" "}),n.trim()&&o.push(n.trim()),o.join("\n")}(o);!function(e){let t=e.data("label").split("\n").length;e.style({height:20+10*t,width:20+10*t})}(r.add({data:{id:t,label:e,backgroundColor:n,shape:a}}))}}